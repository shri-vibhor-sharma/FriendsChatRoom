<!doctype html>
<html>
  <head>
    <title>Super chat App</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
    </style>
  </head>
  <body>
    <ul id="messages"></ul>
    <form action="">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>
      
      <script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
      
<script>
    function getQueryParams(qs) {
    qs = qs.split('+').join(' ');

    var params = {},
        tokens,
        re = /[?&]?([^=]+)=([^&]*)/g;

    while (tokens = re.exec(qs)) {
        params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
    }

    return params;
}
      
  var socket = io();
  $('form').submit(function(){
      
      
       function getQueryParams(qs) {
    qs = qs.split('+').join(' ');

    var params = {},
        tokens,
        re = /[?&]?([^=]+)=([^&]*)/g;

    while (tokens = re.exec(qs)) {
        params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
    }

    return params;
}
      
      
      var query = getQueryParams(document.location.search);
var names= query.varname+':';
     // alert(names);
      
      
      
      
      
    socket.emit('chat_message', names+$('#m').val());
    $('#m').val('');
    return false;
  });
  socket.on('chat_message', function(msg){
      
 
     
    $('#messages').append($('<li>').text(msg));
      
      
      //to get desktop notification
      
      // request permission on page load

  if (!Notification) {
    alert('Desktop notifications not available in your browser. Try Chromium.'); 
    return;
  }

  if (Notification.permission !== "granted")
    Notification.requestPermission();



  if (Notification.permission !== "granted")
    Notification.requestPermission();
  else {
      if(document.hidden==true){
    var notification = new Notification('new message:', {
      icon: 'http://sahrzad.net/blog/wp-content/uploads/2016/05/messages-mac-icon-100638468-large.png',
      body: " "+msg,
        
        'content-available': '1',
      //  vibrate:[200,100,200],
        
    });
setTimeout(notification.close.bind(notification), 4000);
        
    notification.onclick = function () {
     // window.open("http://stackoverflow.com/a/13328397/1269037");      
    };
          
   

  }
  }

      //above code is for desktop notification
      
      
      
  });
    
    socket.on('user_connected',function(username){
        
      //var query = getQueryParams(document.location.search);
//var names= text(username);
      // alert(username+":joined the chat");
        
      // window.open ("http://thevibhor.com","mywindow","status=1");
       // $('#messages').append($('<li>').'a new user:joined the chat');
        
        if (!Notification) {
    alert('Desktop notifications not available in your browser. Try Chromium.'); 
    return;
  }

  if (Notification.permission !== "granted")
    Notification.requestPermission();




  else {
      if(document.hidden==true){
    var notification = new Notification('Yo!', {
      icon: 'http://sahrzad.net/blog/wp-content/uploads/2016/05/messages-mac-icon-100638468-large.png',
      body: username+":joined the chat! ",
    
    });
          setTimeout(notification.close.bind(notification), 4000);

    notification.onclick = function () {
     // window.open("http://stackoverflow.com/a/13328397/1269037");      
    };

  }}
        
        
        
        
        
        
        });
    
    
</script>
    
      
  </body>
</html>